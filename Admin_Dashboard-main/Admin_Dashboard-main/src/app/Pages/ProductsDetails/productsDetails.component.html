<!-- Product Details Section -->
<div class="product-detail-container" *ngIf="products">

  <!-- TOAST CONTAINER -->
  <div class="toast-container" *ngIf="showToast">
    <div class="toast show">
      {{ toastMessage }}
    </div>
  </div>

  <div class="product-wrapper">

    <!-- Left: Image Section -->
    <div class="image-wrapper">
      <div class="image-section">
        <div class="vertical-thumbnails scrollable-element" *ngIf="!is3DViewActive">
          <img *ngFor="let img of loadedImages; let i = index"
               [src]="img"
               [class.selected]="i === currentIndex"
               (click)="selectImage(i)" />
        </div>

        <div class="main-image-container" *ngIf="!is3DViewActive">
          <img [src]="loadedImages[currentIndex]|| 'assets/logo.png'" class="main-image" />
        </div>

        <!-- Carousel arrows -->
        <button class="carousel-arrow right" (click)="nextImage()">&#10095;</button>

        <!-- 3D View Button -->
        <button class="toggle-3d-btn" (click)="toggle3DView()">
          {{ is3DViewActive ? 'Close 3D View' : 'Open 3D View' }}
        </button>
      </div>
    </div>

    <!-- Right: Info Section -->
    <div class="info-wrapper">

      <!-- Top: Most important info -->
      <div class="main-info">
        <h1 class="product-name">{{ products.name }}</h1>
        <h3 class="product-quantity"><strong>Quantity :</strong>{{ products.quantity }}</h3>
         <div class="stock-status" [ngClass]="{'in-stock': products.quantity > 0, 'out-of-stock': products.quantity === 0}">
          {{ products.quantity > 0 ? 'In Stock' : 'Out of Stock' }}
        <div class="product-price"><strong>Price:</strong> ${{ products.originalPrice }}</div>

        <!-- Color Combinations Section -->
        <div class="color-combinations" *ngIf="products?.colorCombinations">
          <h3>Color Combinations</h3>
          <div class="combo-grid">
            <div *ngFor="let combo of products.colorCombinations; let i = index" class="watch-combo">
              <div class="watch-template" (click)="changeWatchColor(combo)">
                <!-- Band Top -->
                <div class="watch-band" [style.backgroundColor]="combo.band"></div>

                <!-- Watch Case -->
                <div class="watch-case" [style.backgroundColor]="combo.background">
                  <!-- Hour ticks -->
                  <div *ngFor="let tick of [].constructor(12); let j = index"
                       class="watch-tick"
                       [style.transform]="'rotate(' + (j*30) + 'deg) translateY(-30%)'">
                  </div>
                  <!-- Hands -->
                  <div class="watch-hand hour" [style.backgroundColor]="combo.hands"></div>
                  <div class="watch-hand minute" [style.backgroundColor]="combo.hands"></div>
                </div>

                <!-- Band Bottom -->
                <div class="watch-band" [style.backgroundColor]="combo.band"></div>
              </div>
              <span class="combo-label">Combo {{ i+1 }}</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <!-- Edit Icon -->
          <button *ngIf="hasRole('UPDATE_PRODUCT') || hasRole('OWNER')" (click)="editProduct()" title="Edit">
            <i class="fa-solid fa-pen"></i>
          </button>

          <!-- Delete Icon -->
          <button *ngIf="hasRole('DELETE_PRODUCT') || hasRole('OWNER')" (click)="deleteProduct()" title="Delete">
            <i class="fa-solid fa-trash"></i>
          </button>

          <!-- Add to Cart Icon -->
          <button *ngIf="hasRole('CUSTOMER')" (click)="addToCart(products)" title="Add to Cart">
            <i class="fa-solid fa-cart-plus"></i>
          </button>

          <!-- Quantity Selector -->
          <div class="quantity-selector" *ngIf="hasRole('CUSTOMER')">
            <label for="quantity">Qty:</label>
            <input type="number" id="quantity" [(ngModel)]="selectedQuantity" min="1" [max]="products.quantity" />
          </div>

<button class="wishlist-btn" *ngIf="wishlistLoaded" (click)="toggleWishlist()">
  <span class="heart-icon" [class.active]="isInWishlist()">
    {{ flag ? '❤️' : '♡' }}
  </span>
</button>
        </div>

        <p class="product-short-desc">{{ products.description }}</p>
      </div>

      <!-- Bottom: Specs/features -->
      <div class="product-specs">
        <div class="spec-category">
          <h3>General</h3>
          <div><strong>Brand:</strong> {{ products.brand }}</div>
          <div><strong>Shape:</strong> {{ products.shape }}</div>
          <div><strong>Size:</strong> {{ products.size }}</div>
          <div><strong>Weight:</strong> {{ products.weight }} g</div>
        </div>

        <div class="spec-category">
          <h3>Appearance</h3>
          <div><strong>Band Color:</strong> {{ products.bandColor }}</div>
          <div><strong>Hands Color:</strong> {{ products.handsColor }}</div>
          <div><strong>Background:</strong> {{ products.backgroundColor }}</div>
        </div>

        <div class="spec-category">
          <h3>Materials</h3>
          <div><strong>Band:</strong> {{ products.bandMaterial }}</div>
          <div><strong>Case:</strong> {{ products.caseMaterial }}</div>
        </div>

        <div class="spec-category">
          <h3>Features</h3>
          <div><strong>Display:</strong> {{ products.displayType }}</div>
          <div><strong>Numbering:</strong> {{ products.numberingFormat }}</div>
          <div><strong>Waterproof:</strong> {{ products.waterProof ? 'Yes' : 'No' }}</div>
          <div><strong>Date:</strong> {{ products.includesDate ? 'Yes' : 'No' }}</div>
          <div><strong>Full Numerals:</strong> {{ products.hasFullNumerals ? 'Yes' : 'No' }}</div>
          <div><strong>Ticking Sound:</strong> {{ products.hasTickingSound ? 'Yes' : 'No' }}</div>
          <div><strong>Changeable Band:</strong> {{ products.changeableBand ? 'Yes' : 'No' }}</div>
        </div>
      </div>

    </div>
  </div>

  <!-- 3D Carousel Overlay -->
  <div class="carousel-overlay" *ngIf="is3DViewActive">
    <button class="close-btn" (click)="toggle3DView()">✕</button>
    <button class="carousel-arrow left" (click)="prevImage()">&#10094;</button>
    <div class="carousel">
      <img #carouselImg *ngFor="let img of loadedImages" [src]="img" />
    </div>
    <button class="carousel-arrow right" (click)="nextImage()">&#10095;</button>
  </div>

 
 
  <div class="ff" *ngIf="isCustomer">
     <app-recommendation></app-recommendation>
  </div>

</div>
