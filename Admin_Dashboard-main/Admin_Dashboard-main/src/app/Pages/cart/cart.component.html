<div class="home-wrapper">
  <!-- Background Video -->
  <video autoplay muted loop class="video-background">
    <source src="assets/customer_background.mp4" type="video/mp4" />
  </video>

  <div class="toast-container" *ngIf="showToast">
    <div class="toast show">
      {{ toastMessage }}
    </div>
  </div>

  <!-- CART CONTENT -->
  <div class="product-container">
    <h1 class="page-title">üõí My Cart</h1>

    <!-- EMPTY CART MESSAGE -->
    <div *ngIf="cartItems.length === 0 && !loading" class="empty-cart">
      <h2>Your cart is empty üòî</h2>
      <p>Add items to your cart to keep track of products you love!</p>
      <button class="browse-btn" routerLink="/product">Browse Products</button>
    </div>


    <div *ngIf="loading" class="empty-cart">
      <h2>loading ‚åõ</h2>
      <p>this will not take long.</p>
     </div>

    <!-- CART ITEMS LIST -->
    <div *ngIf="cartItems.length > 0" class="cart-list">
      <div *ngFor="let item of cartItems" class="cart-item">
        <input type="checkbox" [(ngModel)]="item.selected" (change)="toggleItemSelection()" class="select-checkbox" />

        <!-- IMAGE -->
        <div class="cart-item-image">
          <img
            [src]="item.images[item.currentImageIndex] || 'assets/logo.png'"
            [alt]="item.productName"
            (click)="navigateToProduct(item)"
          />
        </div>

        <!-- INFO -->
        <div class="cart-item-info">
          <h3 class="product-name" (click)="navigateToProduct(item)">
            {{ item.productName }}
          </h3>
          <p class="product-brand">Brand: {{ item.brand || 'Unknown' }}</p>
          <p>Quantity: {{ item.quantity }}</p>
          <p>
            Unit Price: ${{ item.discountPrice > 0 ? item.discountPrice : item.productPrice }}
          </p>
          <p class="item-total">
            Total: ${{
              (item.discountPrice > 0 ? item.discountPrice : item.productPrice) *
              item.quantity | number : '1.2-2'
            }}
          </p>
        </div>

        <!-- ACTIONS -->
        <div class="cart-item-actions">
          <button class="remove-btn" (click)="removeItemFromCart(item)">
            <i class="fa-solid fa-trash"></i> Remove
          </button>
        </div>
      </div>

      <!-- CART SUMMARY -->
      <div class="cart-summary">
        <p>Total Cart: <strong>${{ getCartTotal() | number : '1.2-2' }}</strong></p>
      </div>

      <!-- BOTTOM CONTROLS -->
      <div class="cart-controls-bottom">
        <label>
          <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" />
          Select All
        </label>
        <button class="remove-btn" (click)="removeSelected()">Remove Selected</button>
        <button class="place-btn" (click)="placeOrderSelected()">Place Order Selected</button>
      </div>
    </div>
  </div>
</div>

<!-- ORDER MODAL -->
<div class="modal-backdrop" *ngIf="showOrderModal">
  <div class="order-modal">
    <h2><i class="fa-solid fa-bag-shopping"></i> Confirm Your Order</h2>
    <p>Order Time: <strong>{{ orderTime }}</strong></p>

    <!-- ORDER ITEMS -->
    <div class="order-items">
      <div *ngFor="let item of selectedItemsForOrder" class="order-item-card">
        <img [src]="item.images[0] || 'assets/logo.png'" class="order-item-image" />
        <div class="order-item-details">
          <h4>{{ item.productName }}</h4>
          <p>Quantity: {{ item.quantity }}</p>
          <p>
            Unit: ${{ item.discountPrice > 0 ? item.discountPrice : item.productPrice }}
          </p>
          <p class="order-item-total">
            Item Total: ${{
              (item.discountPrice > 0 ? item.discountPrice : item.productPrice) *
              item.quantity | number : '1.2-2'
            }}
          </p>
        </div>
      </div>
    </div>

    <!-- GRAND TOTAL -->
    <p class="order-summary">
      Grand Total: <strong>${{ getSelectedItemsTotal() | number : '1.2-2' }}</strong>
    </p>

    <!-- MODAL BUTTONS -->
    <div *ngIf="!orderConfirmed" class="modal-buttons">
      <button class="place-btn" (click)="confirmPayment()">Confirm Payment</button>
      <button class="remove-btn" (click)="cancelOrder()">Cancel</button>
    </div>

    <div *ngIf="orderConfirmed" class="modal-buttons">
      <p class="countdown-text">‚úÖ Waiting for confirmations! ‚è≥ Auto place in {{ countdown }}s</p>
      <button class="remove-btn" (click)="cancelOrder()">Cancel Order</button>
      <button *ngIf="confirmEnabled" class="place-btn" (click)="finalizeOrder()">Confirm Order Now</button>
    </div>
  </div>
</div>
