<!-- Background video -->
<video #videoRef autoplay loop playsinline muted class="background-video">
  <source src="/assets/ad.mp4" type="video/mp4" />
  Your browser does not support the video tag.
</video>

<!-- Dark overlay -->
<div class="overlay"></div>


 
<div style="height: 100px;"></div> <!-- spacer -->

<div class="profile-container">
  <h2>Your Profile</h2>

  <!-- Loading -->
  <p *ngIf="loading">Loading profile...</p>

  <!-- Error -->
  <p *ngIf="errorMsg" class="error-msg">{{ errorMsg }}</p>

  <!-- View Mode -->
  <div *ngIf="user && !editMode && !loading">
    <p><strong>Full Name:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Phone Number:</strong> {{ user.phone }}</p>
    <!-- Password NOT shown in view mode -->
    <p><strong>Role:</strong> {{ user.roles }}</p>

    <button (click)="enterEditMode()">✏️ Edit</button>
    <button (click)="deleteAccount()">🗑️ Delete Account</button>
  </div>

  <!-- Edit Mode -->
  <div *ngIf="user && editMode && !loading">
    <label>
      <strong>Full Name:</strong>
      <input [(ngModel)]="editableUser.username" />
    </label>
    <br />

    <label>
      <strong>Email:</strong>
      <input [(ngModel)]="editableUser.email" />
    </label>
    <br />

    <label>
      <strong>Phone Number:</strong>
      <input [(ngModel)]="editableUser.phone" />
    </label>
    <br />

    <!-- Change Password button, shown only if NOT editing password -->
    <div *ngIf="!editingPassword" style="margin-bottom: 10px;">
      <button
        type="button"
        class="change-password-btn"
        (click)="editingPassword = true"
      >
        Change Password
      </button>
    </div>

    <!-- Password inputs, shown only when editingPassword = true -->
    <div *ngIf="editingPassword">
      <label
        class="password-wrapper"
        style="display: flex; align-items: center; gap: 8px;"
      >
        <strong>Password:</strong>
        <input
          [type]="showPassword ? 'text' : 'password'"
          [(ngModel)]="editableUser.password"
          style="flex: 1;"
        />
        <span
          class="eye-icon"
          [class.visible]="showPassword"
          (click)="showPassword = !showPassword"
          style="cursor: pointer;"
          title="Toggle Password Visibility"
        >
          👁️‍🗨️
          <span class="slash" *ngIf="showPassword"></span>
        </span>
      </label>
      <br />

      <label
        class="password-wrapper"
        style="display: flex; align-items: center; gap: 8px;"
      >
        <strong>Confirm Password:</strong>
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          [(ngModel)]="editableUser.confirmPassword"
          style="flex: 1;"
        />
        <span
          class="eye-icon"
          [class.visible]="showConfirmPassword"
          (click)="showConfirmPassword = !showConfirmPassword"
          style="cursor: pointer;"
          title="Toggle Confirm Password Visibility"
        >
          👁️‍🗨️
          <span class="slash" *ngIf="showConfirmPassword"></span>
        </span>
      </label>
      <br />

      <button
        type="button"
        class="cancel-password-btn"
        (click)="cancelPasswordEdit()"
      >
        Cancel Password Change
      </button>
    </div>

    <label>
      <strong>Role:</strong>
      <input [value]="editableUser.roles" disabled />
    </label>
    <br />

    <button (click)="saveChanges()">💾 Save</button>
    <button (click)="cancelEdit()">❌ Cancel</button>
  </div>

  <!-- Fallback -->
  <div *ngIf="!user && !loading && !errorMsg">
    <p>No user information available.</p>
  </div>
</div>
